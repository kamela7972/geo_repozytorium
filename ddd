 System;
Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Dziennik
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        public Dodawanie_ucznia FormDodajUcznia { set; get; }

        public Dodawanie_przedmiotu FormDodajPrzedmiot { set; get; }

        public List<Uczen> lista_uczniow { set; get; }

        public List<Przedmiot> lista_przedmiotow { set; get; }

        public List<Ocena> lista_ocen { set; get; }
        
        public MainWindow()
        {
            InitializeComponent();
            this.lista_uczniow = new List<Uczen>();
            this.lista_przedmiotow = new List<Przedmiot>();
            this.lista_ocen = new List<Ocena>();
            this.tabela_uczniow.Columns.Add(new DataGridTextColumn { Header = "Imie", Binding = new Binding("Imie") });
            this.tabela_uczniow.Columns.Add(new DataGridTextColumn { Header = "Nazwisko", Binding = new Binding("Nazwisko") });
            this.tabela_uczniow.Columns.Add(new DataGridTextColumn { Header = "Data urodzenia", Binding = new Binding("Data_ur") });
            this.tabela_przedmiotow.Columns.Add(new DataGridTextColumn { Header = "Nazwa przedmiotu", Binding = new Binding("Nazwa") });
            this.lista_ocen_ucznia.IsEnabled = false;
            this.lista_ocen_z_przedmiotu.IsEnabled = false;
        }

        private void dodaj_ucznia_Click(object sender, RoutedEventArgs e)
        {
            FormDodajUcznia = new Dodawanie_ucznia(this);
            FormDodajUcznia.dodaj_edytuj = 1;
            FormDodajUcznia.anuluj.Visibility = (Visibility)1;
            FormDodajUcznia.Show();
            this.dodaj_ucznia.IsEnabled = false;
        }

        private void dodaj_przedmiot_Click(object sender, RoutedEventArgs e)
        {
            FormDodajPrzedmiot = new Dodawanie_przedmiotu(this);
            FormDodajPrzedmiot.dodaj_edytuj = 1;
            FormDodajPrzedmiot.anuluj.Visibility = (Visibility)1;
            FormDodajPrzedmiot.Show();
            this.dodaj_przedmiot.IsEnabled = false;
        }

        private void usun_ucznia_Click(object sender, RoutedEventArgs e)
        {
            MessageBoxResult result = MessageBox.Show("Czy chcesz usunac dany element ?","Czy usunąć",MessageBoxButton.OKCancel);
            if(result.Equals(MessageBoxResult.OK))
            {
                Uczen uczen = (Uczen)this.tabela_uczniow.SelectedItem;
                this.tabela_uczniow.Items.Remove(uczen);
                this.lista_uczniow.Remove(uczen);
            }
        }

        private void usun_przedmiot_Click(object sender, RoutedEventArgs e)
        {
            MessageBoxResult result = MessageBox.Show("Czy chcesz usunac dany element ?","Czy usunąć",MessageBoxButton.OKCancel);
            if (result.Equals(MessageBoxResult.OK))
            {
                Przedmiot przedmiot = (Przedmiot)this.tabela_przedmiotow.SelectedItem;
                this.tabela_przedmiotow.Items.Remove(przedmiot);
                this.lista_przedmiotow.Remove(przedmiot);
            }
        }

        private void edytuj_ucznia_Click(object sender, RoutedEventArgs e)
        {
            FormDodajUcznia = new Dodawanie_ucznia(this);
            FormDodajUcznia.Title = "Edycja ucznia";
            Uczen uczen = (Uczen)this.tabela_uczniow.SelectedItem;
            FormDodajUcznia.imie.Text = uczen.Imie;
            FormDodajUcznia.nazwisko.Text = uczen.Nazwisko;
            FormDodajUcznia.data_ur.Text = uczen.Data_ur.ToString();
            FormDodajUcznia.adres.Text = uczen.Adres;
            FormDodajUcznia.telefon.Text = uczen.Telefon;
            FormDodajUcznia.email.Text = uczen.Email;

            FormDodajUcznia.dodaj.Content = "Ok";
            FormDodajUcznia.dodaj_edytuj = 2;
            FormDodajUcznia.anuluj.Visibility = (Visibility)0;
            FormDodajUcznia.ShowDialog();
        }

        private void edytuj_przedmiot_Click(object sender, RoutedEventArgs e)
        {
            FormDodajPrzedmiot = new Dodawanie_przedmiotu(this);
            FormDodajPrzedmiot.Title = "Edycja przedmiotu";
            Przedmiot przedmiot = (Przedmiot)tabela_przedmiotow.SelectedItem;
            FormDodajPrzedmiot.nazwa.Text = przedmiot.Nazwa;
            FormDodajPrzedmiot.liczba_godzin.Text = przedmiot.Liczba_godzin.ToString();
            FormDodajPrzedmiot.podrecznik.Text = przedmiot.Podrecznik;
            FormDodajPrzedmiot.nauczyciel.Text = przedmiot.Nauczyciel;

            FormDodajPrzedmiot.dodaj.Content = "Ok";
            FormDodajPrzedmiot.dodaj_edytuj = 2;
            FormDodajPrzedmiot.anuluj.Visibility = (Visibility)0;
            FormDodajPrzedmiot.ShowDialog();
        }

        private void tabela_uczniow_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            Uczen uczen = (Uczen)tabela_uczniow.SelectedItem;
            try
            {
                this.adres.Text = uczen.Adres;
                this.telefon.Text = uczen.Telefon;
                this.email.Text = uczen.Email;
            }
            catch
            {
                this.adres.Text = "";
                this.telefon.Text = "";
                this.email.Text = "";
            }
            this.lista_ocen_ucznia.IsEnabled = true;
        }

        private void tabela_przedmiotow_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            Przedmiot przedmiot = (Przedmiot)tabela_przedmiotow.SelectedItem;
            try
            {
                this.liczba_godzin.Text = przedmiot.Liczba_godzin.ToString();
                this.podrecznik.Text = przedmiot.Podrecznik;
                this.nauczyciel.Text = przedmiot.Nauczyciel;
            }
            catch
            {
                this.liczba_godzin.Text = "";
                this.podrecznik.Text = "";
                this.nauczyciel.Text = "";
            }
            this.lista_ocen_z_przedmiotu.IsEnabled = true;
        }

        private void lista_ocen_ucznia_Click(object sender, RoutedEventArgs e)
        {
            ListaOcenUcznia FormListaOcen = new ListaOcenUcznia(this);
            string imie = ((Uczen)this.tabela_uczniow.SelectedItem).Imie;
            string nazwisko = ((Uczen)this.tabela_uczniow.SelectedItem).Nazwisko;
            int id = ((Uczen)this.tabela_uczniow.SelectedItem).Id;

            List<NazwaWartosc> l_obiekt = (from p in this.lista_przedmiotow
                            join o in this.lista_ocen on p.Id equals o.Id_przedmiotu
                            where (o.Id_ucznia == id)
                            select new NazwaWartosc { Nazwa = p.Nazwa, Wartosc = o.Wartosc }).ToList();
            
            foreach (NazwaWartosc o in l_obiekt)
            {
                FormListaOcen.lista_ocen.Items.Add(o);
            }

            FormListaOcen.Title = "Lista ocen ucznia : \n" + imie + " " + nazwisko;
            FormListaOcen.Show();
        }

        private void lista_ocen_z_przedmiotu_Click(object sender, RoutedEventArgs e)
        {
            ListaOcenZPrzedmiotu FormListaOcen = new ListaOcenZPrzedmiotu(this);
            string nazwa = ((Przedmiot)this.tabela_przedmiotow.SelectedItem).Nazwa;
            int id_przedmiotu = ((Przedmiot)this.tabela_przedmiotow.SelectedItem).Id;
            List<ImieNazwiskoWartosc> l_obiekt = (from u in this.lista_uczniow
                                                  join o in this.lista_ocen on u.Id equals o.Id_ucznia
                                                  where o.Id_przedmiotu == id_przedmiotu
                                                  select new ImieNazwiskoWartosc 
                                                  { Imie = u.Imie, Nazwisko = u.Nazwisko, Wartosc = o.Wartosc }).ToList();

            foreach(ImieNazwiskoWartosc obiekt in l_obiekt)
            {
                FormListaOcen.lista_ocen.Items.Add(obiekt);
            }
            FormListaOcen.Title = "Lista ocen z przedmiotu : " + nazwa;
            FormListaOcen.Show();
        }
    }
}
